\begin{tikzpicture}[
    node distance=2cm,
    box/.style={rectangle, draw=black, rounded corners, fill=white, align=center, minimum height=1.5cm, minimum width=3cm, font=\bfseries},
    smallbox/.style={rectangle, draw=black, rounded corners, fill=gray!10, align=center, minimum height=1cm, minimum width=2.5cm, font=\small},
    arrow/.style={->, >=stealth, thick},
    labeltext/.style={midway, fill=white, font=\scriptsize, align=center}
]

% 1. World Container (Central Hub)
% It contains: array[agents], grid, config, index_map
\node (world) [box, fill=orange!20, minimum width=6cm, minimum height=4cm] {};
\node [align=center, font=\bfseries] at (world.north) [below=0.2cm] {World Container};

% Contents of World (Nodes inside)
\node (agents_array) [smallbox, fill=white] at (world.center) [above=0.2cm] {array[agents]};
\node (w_grid) [smallbox, fill=white, below=0.3cm of agents_array, xshift=-1.5cm] {grid};
\node (w_config) [smallbox, fill=white, below=0.3cm of agents_array, xshift=1.5cm] {config};
\node (w_index_map) [smallbox, fill=white, below=0.3cm of w_grid] {index\_map};

% 2. Config Container
\node (config) [box, left=3cm of world] {Config Container};

% 3. Grid Container
\node (grid) [box, right=3cm of world] {Grid Container \\ \small{array[cells]} \\ \small{array[hep\_data]}};

% 4. Cell Container
\node (cell) [box, below=1.5cm of grid] {Cell Container \\ \small{array[agent\_ids]} \\ \small{properties}};

% 5. Cluster Container
\node (cluster) [box, below=1.5cm of config] {Cluster Container \\ \small{array[agent\_ids]}};

% 6. Individual Agent
\node (agent) [box, below=4cm of world] {Individual Agent \\ \small{position, gender...}};

% Arrows

% Config -> World "provides configuration of model"
\draw [arrow] (config) -- node[labeltext] {provides configuration\\of model} (world);

% Index Map -> World "returns agent by its id"
% Since index_map is inside world, we draw from the internal node to the world boundary or generally
% User said "from index map to world". I'll draw from the internal node to the Agent Array or World container.
% Let's draw it from the internal w_index_map to w_agents_array inside.
\draw [arrow] (w_index_map) -- node[labeltext] {returns agent by its id} (agents_array);
% Note: Ideally this arrow is within the box.

% Grid -> World
\draw [arrow] (grid) -- (world);

% Agents Array -> World (Internal item to World? Or logic flow?)
% Agents Array is inside World. I'll just leave it as contained.

% Individual Agent -> Agents Array
\draw [arrow] (agent) -- (agents_array);

% Cells -> Agents (meaning Individual Agent) "using index map"
\draw [arrow] (cell) |- node[labeltext, pos=0.7] {using index map} (agent);

% Cluster -> Agents "using index map"
\draw [arrow] (cluster) |- node[labeltext, pos=0.7] {using index map} (agent);

% Individual Agent -> Individual Agent "using index map"
\draw [arrow] (agent) edge [loop below] node[labeltext] {using index map} (agent);

\end{tikzpicture}
